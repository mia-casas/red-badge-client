import React from 'react';
import {IUser, IUserProps, ILogin} from './Interfaces'
import {FormControl, Container, Button, TextField, PropTypes } from '@material-ui/core';
import {Form} from 'reactstrap'

type login = { login: boolean}

const title = (login: true) => {
    return login ? 'Login' : 'Signup'
}

const toggleFields = (e: React.BaseSyntheticEvent, props: login) => {
    e.preventDefault();
    
    // this.setState({login: false})

    return (
        <div>
            <TextField 
            placeholder="First Name"
            name="firstName"
            onChange = {(e) => this.handleChange(e)}
             ></TextField>
            <TextField 
            placeholder="Last Name"
            name="lastName"
            onChange = {(e) => this.handleChange(e)}
            ></TextField>        
        </div>
    )
}  // to be cont...

class Auth extends React.Component<IUser & ILogin & IUserProps & login>{
    constructor(props: any){
        super(props);
        this.state = {
            email: '',
            password: '',
            token: '',
            login: true
        }
    }

    authUser = (e: React.BaseSyntheticEvent, props:any) => {
        e.preventDefault();
        const url = login ? `http://localhost:5005/user/login` : `http://localhost:5005/user/register`;
        const bodyObj = login ? {
            email: this.state.email,
            password: this.state.password
        } : {
            firstName: this.state.firstName,
            lastName: this.state.lastName,
            email: this.state.email,
            password: this.state.password
        }
        fetch(url, {
            method: "POST",
            body: JSON.stringify(bodyObj),
            headers: new Headers({
                'Content-Type': 'application/json'
            })
        }).then(response => response.json())
        .then(data => this.setState({token: data.token}))  
    }
    componentDidUpdate(){
        setTimeout(() => {localStorage.setItem('token', `${this.state.token}`)}, 500)
    }

    handleChange = (e: React.BaseSyntheticEvent) => {
        // console.log(e.target.name, e.target.value)
        this.setState((prevState) => ({
            ...prevState, [e.target.name] : e.target.value as Pick<ILogin, keyof ILogin>
        }))
    }

    render(){
        return(
            <div>
                <Form onSubmit={(e) => this.authUser(e)}>
                    <h1>{title()}</h1>
                    {toggleFields()}
                <FormControl>
                    <TextField 
                    placeholder="Email"
                    name="email"
                    onChange = {(e) => this.handleChange(e)}
                    ></TextField>
                    <TextField 
                    placeholder="Password"
                    name="password"
                    onChange = {(e) => this.handleChange(e)}
                    ></TextField>
                    </FormControl>
                    <div><Button type='submit'>Login</Button></div>
                    <div><Button type='submit' onClick={(e) => this.toggleFields}>Not a User? Create an Account</Button></div>
                </Form>
            </div>
        )
    }
}

export default Auth